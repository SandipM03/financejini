- name: Check Supabase connectivity
  run: |
    set -euxo pipefail

    HOST=$(echo "${SUPABASE_URL}" | awk -F/ '{print $3}')
    echo "Resolved host: $HOST"

    echo "ğŸ” Checking DNS resolution..."
    dig +short "$HOST"

    echo "ğŸ”Œ Checking TCP connectivity on port 443..."
    timeout 5 bash -c "</dev/tcp/$HOST/443" && echo "TCP connection successful" || echo "TCP connection failed"

    echo "ğŸ” Checking TLS handshake..."
    echo | openssl s_client -connect "$HOST:443" -servername "$HOST" -brief

    echo "ğŸŒ Checking HTTP status..."
    curl -I "$SUPABASE_URL/rest/v1/" || echo "HTTP request failed"
